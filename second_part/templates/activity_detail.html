{% extends "base.html" %}
{% block title %}Activity Detail - {{ activity.get('name', 'Activity') }}{% endblock %}

{% block content %}
<div class="container">
  <h2>Activity Detail for Activity {{ activity.get('id') }}</h2>
  <h4>{{ activity.get('name') }}</h4>
  <p>Date: {{ activity.get('start_date') }}</p>
  <p>Distance: {{ (activity.get('distance')/1000)|round(2) }} km</p>
  <p>Elapsed Time: {{ activity.get('elapsed_time') }} seconds</p>
  <!-- Add more details as desired -->

  <!-- Activity Analysis Graph -->
  <div id="activity-chart" style="width:100%;height:500px;"></div>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>
    // Create a simple heart rate trend chart using lap data
    var laps = {{ activity.get('laps')|tojson }};
    var hrData = [];
    if (laps) {
      laps.forEach(function(lap) {
         if (lap.average_heartrate) {
           hrData.push(lap.average_heartrate);
         }
      });
    }
    var trace = {
      x: Array.from({length: hrData.length}, (_, i) => i + 1),
      y: hrData,
      mode: 'lines+markers',
      name: 'Avg Heart Rate'
    };
    var layout = {
      title: 'Heart Rate Trend',
      xaxis: { title: 'Lap Number' },
      yaxis: { title: 'Heart Rate (bpm)' }
    };
    Plotly.newPlot('activity-chart', [trace], layout);
  </script>

  <div class="mt-3">
    <a href="/view_activities/{{ athlete_id }}" class="btn btn-secondary">Back to Activities</a>
  </div>
</div>
{% endblock %}
