{% extends "base.html" %}
{% block title %}Activity Detail - Activity {{ activity.activity_id }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Activity Details</h2>
  <h4>Activity ID: {{ activity.activity_id }}</h4>
  <p><strong>Athlete ID:</strong> {{ activity.athlete_id }}</p>
  
  <!-- Display key stats in a nicely formatted table -->
  <table class="table table-bordered">
    <tr>
      <th>Elapsed Time</th>
      <td>
        {{ activity.elapsed_time }} seconds 
        ({{ (activity.elapsed_time / 60)|round(1) }} minutes)
      </td>
    </tr>
    <tr>
      <th>Distance</th>
      <td>
        {{ activity.distance }} meters 
        ({{ (activity.distance / 1000)|round(2) }} km)
      </td>
    </tr>
    <tr>
      <th>Average Heart Rate</th>
      <td>{{ activity.mean_hr }} bpm</td>
    </tr>
    <tr>
      <th>HR Standard Deviation</th>
      <td>{{ activity.stdev_hr }}</td>
    </tr>
    <tr>
      <th>HR Peak Frequency</th>
      <td>{{ activity.freq_hr }}</td>
    </tr>
    <tr>
      <th>Time in Zone 1</th>
      <td>{{ activity.time_in_z1 }}</td>
    </tr>
    <tr>
      <th>Time in Zone 2</th>
      <td>{{ activity.time_in_z2 }}</td>
    </tr>
    <tr>
      <th>Time in Zone 3</th>
      <td>{{ activity.time_in_z3 }}</td>
    </tr>
    <tr>
      <th>Time in Zone 4</th>
      <td>{{ activity.time_in_z4 }}</td>
    </tr>
    <tr>
      <th>Time in Zone 5</th>
      <td>{{ activity.time_in_z5 }}</td>
    </tr>
    <tr>
      <th>Elevation Gain</th>
      <td>{{ activity.elevation }} meters</td>
    </tr>
    <tr>
      <th>Elevation Std. Dev.</th>
      <td>{{ activity.stdev_elevation }}</td>
    </tr>
    <tr>
      <th>Elevation Peak Frequency</th>
      <td>{{ activity.freq_elevation }}</td>
    </tr>
    <tr>
      <th>Pace</th>
      <td>{{ activity.pace }}</td>
    </tr>
    <tr>
      <th>Pace Std. Dev.</th>
      <td>{{ activity.stdev_pace }}</td>
    </tr>
    <tr>
      <th>Pace Peak Frequency</th>
      <td>{{ activity.freq_pace }}</td>
    </tr>
    <tr>
      <th>Cadence</th>
      <td>{{ activity.cadence }}</td>
    </tr>
    <tr>
      <th>Athlete Count</th>
      <td>{{ activity.athlete_count }}</td>
    </tr>
  </table>

  <!-- A Plotly pie chart to show heart rate zone distribution -->
  <div id="hr-zone-chart" style="width:100%;height:400px;"></div>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>
    // Prepare HR zone values from the activity record
    var hrZoneValues = [
      {{ activity.time_in_z1 }},
      {{ activity.time_in_z2 }},
      {{ activity.time_in_z3 }},
      {{ activity.time_in_z4 }},
      {{ activity.time_in_z5 }}
    ];
    var hrZoneLabels = ['Zone 1', 'Zone 2', 'Zone 3', 'Zone 4', 'Zone 5'];

    var data = [{
      values: hrZoneValues,
      labels: hrZoneLabels,
      type: 'pie'
    }];

    var layout = {
      title: 'Heart Rate Zone Distribution'
    };

    Plotly.newPlot('hr-zone-chart', data, layout);
  </script>

  <div class="mt-3">
    <a href="/view_activities/{{ athlete_id }}" class="btn btn-secondary">
      <i class="bi bi-arrow-left"></i> Back to Activities
    </a>
  </div>
</div>
{% endblock %}
